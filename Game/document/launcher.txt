Loong自动更新程序文档

-----------------------------------------------------------------------------
文件目录结构
-----------------------------------------------------------------------------
主程序文件:launcher.exe 必须放在游戏根目录下
各种资源目录:launcher目录 必须放在游戏根目录下

launcher目录下
   |----*.bmp 各种背景图片
   |----launcher.ini       自动更新配置文件:自动更新程序的所有配置
   |----patchinfo.txt      自动更新升级信息文件:用来检测应该下载哪个更新包
   |----serverinfo.xml     服务器大区信息文件:供客户端登陆时显示大区用
   |----launcher_table.xml 自动更新多语言文件:出其他语言版本仅需翻译此文件


-----------------------------------------------------------------------------
launcher.ini 详解
-----------------------------------------------------------------------------
LocalLauncher =1.0.1.0
本地Launch版本,此项请勿手动修改,自动更新程序更新完毕后,会自动升级此版本号
如果需要测试更新流程，可以手动修改此版本好为起始版本号

LocalGame =1.2.2.0
本地Game版本,此项请勿手动修改,自动更新程序更新自己后,会自动升级此版本号
如果需要测试更新流程，可以手动修改此版本好为起始版本号

PatchInfo = http://219.239.35.240/patchinfo.txt, http://219.239.35.241/patchinfo.txt
从哪里下载patchinfo.txt,多个网址可用逗号分隔,自动更新程序会依次尝试下载,直到成功下载
或者所有网址都尝试完毕

ServerInfo =  http://219.239.35.240/serverinfo.xml
从哪里下载serverinfo.xml,多个网址可用逗号分隔,自动更新程序会依次尝试下载,直到成功下载
或者所有网址都尝试完毕

NewLauncher = http://219.239.35.240/launcher.new
从哪里下载最新版launch.new,自动更新程序下载完此文件后,会自动将其覆盖自身(launcher.exe),
并重新运行.多个网址可用逗号分隔,自动更新程序会依次尝试下载,直到成功下载或者所有网址都
尝试完毕

GameExe = Client\client.exe
指明游戏可执行文件的路径和文件名

GameConfig = Config\ClientCfg.xml
游戏配置文件,自动更新通过修改此文件来修改游戏的各种图像配置

URL = http://219.239.35.240
自动更新程序主窗口显示的网页地址
友情提示: 在网页文件中加入<body scroll="no" >可以去掉网页上显示的滚动条,
加入<BODY oncontextmenu="return false"> 可以去掉右键菜单



-----------------------------------------------------------------------------
patchinfo.txt 详解
-----------------------------------------------------------------------------
[version]字段
latest_game = 1.2.2.0  
表示游戏最新版本号，自动更细程序每次更新一个版本后，会检测是否已经到达此版本，如果
未到达，会尝试继续更新

latest_launch = 1.0.1.0
表示自动更新程序自己的最新版本号，自动更细程序每次更新一个版本后，会检测是否已经到达
此版本，如果未到达，会尝试继续更新

[patch_n]字段
此字段n编号请连续填写，n从0开始，每次加一(并不要求版本号的顺序与n的顺序一样)

from = 1.0.0.0
表示当前patch适用于1.0.0.0版本

to = 1.1.0.0
表示当前patch会将游戏升级到1.1.0.0版本

url = http://219.239.35.240/test1.cpk
patch的下载地址,多个网址可用逗号分隔,自动更新程序会依次尝试下载,直到成功下载或者所有
网址都尝试完毕,此文件的文件名可以任意命名,但建议不要使用中文

md5 = a76dce2464cff63fad7d7400f5903c1e
此文件的MD5,自动更新程序下载完后会检验所下载文件的md5看是否与此md5匹配,如果不匹配将会
自动重新下载.如果此MD5留空不填，自动更新程序将不会进行验证



-----------------------------------------------------------------------------
serverinfo.xml 详解
-----------------------------------------------------------------------------
自动更新程序每次运行时会自动下载此文件,然后不做任何处理,此文件仅供客户端启动时
显示、选择大区服务器时使用



-----------------------------------------------------------------------------
launcher_table.xml 详解
-----------------------------------------------------------------------------
自动更新程序显示的所有文本信息都通过此文件读取,包括各种界面上的文字、提示信息等
在制作各种语言版本时,只用翻译此文件即可




-----------------------------------------------------------------------------
自动更新程序详细逻辑流程
-----------------------------------------------------------------------------
1.先删除本地原先下载的更新信息文件patchinfo.txt和服务器信息文件
2.下载更新信息文件patchinfo.txt
3.检测是否需要更新自己,如果需要更新,则下载最新的launcher,并更新自己,然后重新运行
4.分析本次更新需要下载文件,并下载之
5.如果本地存在对应且未下载完的文件,断点续传
6.下载完成后检测MD5,如果不符合则删除此次下载文件并重新下载
7.解压本次更新文件并更新版本号
8.检测是否已经是最新版本,如果不是跳到步骤4
9.下载服务器信息文件
10.备份服务器信息文件供客户端使用











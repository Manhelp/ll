--装备
itemTable = {}
itemTable[8] = {8017001,8027001,8037001,8047001,8050801,8051801,8060801,8061801,8070801,8071801,8080801,8081801,8090801,8091801,8101201}
itemTable[9] = {8017002,8027002,8037002,8047002,8050802,8051802,8060802,8061802,8070802,8071802,8080802,8081802,8090802,8091802,8101202}
itemTable[10] = {8017003,8027003,8037003,8047003,8050803,8051803,8060803,8061803,8070803,8071803,8080803,8081803,8090803,8091803,8101203}
itemTable[11] = {8017004,8027004,8037004,8047004,8050804,8051804,8060804,8061804,8070804,8071804,8080804,8081804,8090804,8091804,8101204}
itemTable[12] = {8017005,8027005,8037005,8047005,8050805,8051805,8060805,8061805,8070805,8071805,8080805,8081805,8090805,8091805,8101205}
itemTable[13] = {8017006,8027006,8037006,8047006,8050806,8051806,8060806,8061806,8070806,8071806,8080806,8081806,8090806,8091806,8101206}
itemTable[14] = {8011003,8011004,8011005,8011006,8011007,8011008,8011009,8011010,8011011,8021003,8021004,8021005,8021006,8021007,8021008,8021009,
	8021010,8021011,8031003,8031004,8031005,8031006,8031007,8031008,8031009,8031010,8031011,8041003,8041004,8041005,8041006,8041007,8041008,8041009,
	8041010,8041011,8050105,8050106,8050107,8050108,8050109,8050110,8050111,8051105,8051106,8051107,8051108,8051109,8051110,8051111,8060103,8060104,
	8060105,8060106,8060107,8060108,8060109,8060110,8060111,8061103,8061104,8061105,8061106,8061107,8061108,8061109,8061110,8061111,8070103,8070104,
	8070105,8070106,8070107,8070108,8070109,8070110,8070111,8071103,8071104,8071105,8071106,8071107,8071108,8071109,8071110,8071111,8080103,8080104,
	8080105,8080106,8080107,8080108,8080109,8080110,8080111,8081103,8081104,8081105,8081106,8081107,8081108,8081109,8081110,8081111,8090103,8090104,
	8090105,8090106,8090107,8090108,8090109,8090110,8090111,8091103,8091104,8091105,8091106,8091107,8091108,8091109,8091110,8091111,8100103,8100104,
	8100105,8100106,8100107,8100108,8100109,8100110,8100111,8110103,8110104,8110105,8110106,8110107,8110108,8110109,8110110,8110111,8111103,8111104,
	8111105,8111106,8111107,8111108,8111109,8111110,8111111,8121103,8121104,8121105,8121106,8121107,8121108,8121109,8121110,8121111,8122103,8122104,
	8122105,8122106,8122107,8122108,8122109,8122110,8122111,8130103,8130104,8130105,8130106,8130107,8130108,8130109,8130110,8130111}
itemTable[15] = {8050207,8051207,8060207,8061207,8070207,8071207,8080207,8081207,8090207,8091207,8100207,8110207,8111207,8121207,8122207,8130207}
itemTable[16] = {8050208,8051208,8060208,8061208,8070208,8071208,8080208,8081208,8090208,8091208,8100208,8110208,8111208,8121208,8122208,8130208}
itemTable[17] = {8050209,8051209,8060209,8061209,8070209,8071209,8080209,8081209,8090209,8091209,8100209,8110209,8111209,8121209,8122209,8130209}
itemTable[18] = {8050210,8051210,8060210,8061210,8070210,8071210,8080210,8081210,8090210,8091210,8100210,8110210,8111210,8121210,8122210,8130210}
itemTable[23] = {8161011,8161012,8161013,8161014,8161015,8160021,8160022,8160027,8160032,8160033,8171011,8171012,8171013,8171014,8171015,8170021,8170022,8170027,8170032,8170033}
itemTable[58] =	{3100095,3100096,3100097,3100098,3100099,3100100,3100105,3100106,3100107,3100108,3100109,3100110,3100115,3100116,3100117,3100118,
	3100119,3100120,3100125,3100126,3100127,3100128,3100129,3100130,3100135,3100136,3100137,3100138,3100139,3100140,3100145,3100146,3100147,3100148,
	3100149,3100150,3100155,3100156,3100157,3100158,3100159,3100160,3100165,3100166,3100167,3100168,3100169,3100170}
itemTable[59] = {4400001,4400002,4400003,4400004,4400005,4400006,4400007,4400008,4400009,4400010,4400011,4400012,4400013,4400014,4400015,4400016,4400017,4400018,4400019,4400020,4400021,4400022,4400023}
itemTable[60] = {4400301,4400302,4400303,4400304,4400305,4400306,4400307,4400308,4400309,4400310,4400311,4400312,4400313,4400314,4400315,4400316,
	4400317,4400318,4400319,4400320,4400321,4400322,4400323,4400324,4400325,4400326,4400327,4400328,4400329,4400330,4400331,4400332}
itemTable[61] = {3070022,3070023,4400031,4400032,4400033,4400034,4400035,4400036,4400037,4400038,4400039,4400040,4400041,4400042,4800053}

--副本
f_Roles = {}
f_Roles[1] = {}
f_Roles[2] = {}
f_Roles[3] = {}
f_Roles[4] = {}
f_Roles[5] = {}
f_Roles[6] = {}
f_Roles[7] = {}

--妖精之泪
yaoJing_Roles = {}

--百鬼总人数
baiGui_Roles = {}

--勇闯魔窟每日人数
yongChuang_Roles = {}

--进入炼魂殿总人数
lianHun_Roles = {}

--在炼魂殿提交道具总人数
lianHunQ_Roles = {}

--竞技场总人数
arena_Roles = {}

--1第几次数据更新
--2通过怪物掉落的总金钱
--3通过任务获得的总金钱
--4玩家通过购买道具消耗的金钱
--5玩家通过强化消耗的金钱
--6玩家通过合成消耗的金钱
--7玩家在天地宫通过怪物掉落获得的金钱
--8每天生成40传说装备的总数量
--9每天生成60传说装备的总数量
--10每天生成80传说装备的总数量
--11每天生成40传奇装备的总数量
--12每天生成60传奇装备的总数量
--13每天生成80传奇装备的总数量
--14生成所有生产装备的数量
--15生成60-65级蓝色魔性装备数量
--16生成70-75级蓝色魔性装备数量
--17生成80-85级蓝色魔性装备数量
--18生成90-95级蓝色魔性装备数量
--19生成60-65级橙色魔性装备数量
--20生成70-75级橙色魔性装备数量
--21生成80-85级橙色魔性装备数量
--22生成90-95级橙色魔性装备数量
--23生成粉色妖精的数量
--24进入30级副本人数	f01.lua:r24
--25进入40级副本人数	f02.lua:r36
--26进入50级副本人数	f03.lua:r39
--27进入60级副本人数	f04.lua:r18
--28进入70级副本人数	f05.lua:r31
--29进入80级副本人数	f06.lua:r44
--30进入90级副本人数	f07.lua:r18
--31进入30级副本次数	同上
--32进入40级副本次数
--33进入50级副本次数
--34进入60级副本次数
--35进入70级副本次数
--36进入80级副本次数
--37进入90级副本次数
--38进入妖精庇护所次数	ShangGuYaoJingBHS.lua:r741
--39消失的蓝色以上装备总数量
--40被点化的蓝色以上装备总数量
--41北洲天雪出现妖精的总次数	JuXingGuai_OnDie.lua:r12,17
--42西州幻林出现妖精的总次数	JuXingGuai_OnDie.lua:r25,30
--43南洲迷沼出现妖精的总次数	JuXingGuai_OnDie.lua:r38,43
--44东洲冥山出现妖精的总次数	JuXingGuai_OnDie.lua:r51,56,64,69
--45每天参与妖精之泪抓妖精的总人数
--46每天参与妖精之泪的总次数
--47每天参加百鬼炼狱的总人数	baiguilianyu.lua:r314
--48每天参加勇闯魔窟的总人数 YongChuangMoKu.lua:r304
--49每天参加三神的总人数		MoShenLegend.lua:r236,NvShenLegend.lua:r182,ZhanShenLegend.lua:r205
--50每天完成真假魔王第一个任务的总人数
--51每天完成真假魔王第二个任务的总人数
--52每天完成真假魔王第三个任务的总人数
--53玩家每天在真假魔王死亡的总次数
--54每天进入炼魂殿的总人数		MapScript.lua:r137
--55每天在炼魂殿提交道具的总人数	NPC_talk.lua:r126,148,170
--56每天参与竞技场的总人数		Arena.lua:r210
--57每天领取竞技场奖励的总人数	Arena_Act.lua:r131
--58生成新妖精魂数量
--59生成元素果实数量
--60生成新的妖精技能书数量
--61生成妖精秘药数量

--公共函数
function UpdateSeverData(index,var)
--[[
    index = index - 1
	local curTime = tonumber(os.date("%j"))
	if aux.GetWorldDataTable(0) == nil or aux.GetWorldDataTable(0) == 0 then
		aux.SetWorldDataTable(0,curTime)
	elseif aux.GetWorldDataTable(0) ~= curTime then	--与备份时间错开
		for i=1,60 do
			aux.SetWorldDataTable(i,0)
		end
		aux.SetWorldDataTable(0,curTime)
	end
	if aux.GetWorldDataTable(index) == 0 then
		aux.SetWorldDataTable(index, var)
	else
		aux.SetWorldDataTable(index, aux.GetWorldDataTable(index) + var)
	end
]]
end

--2怪物掉落金钱
function x_On_CreMoney(MapID, InstanceID, RoleID, CreatureID, CreatureTypeID, money)
	UpdateSeverData(2, money)
	--天地宫金钱掉落
	if MapID == 3373741608 then
		UpdateSeverData(7, money)
	end
end
aux.RegisterWorldEvent(3, "x_On_CreMoney")

--3任务获得金钱
function x_On_ComQuestMoney(MapID, InstanceID, RoleID, QuestID, money)
	UpdateSeverData(3, money)
end
aux.RegisterRoleEvent(74, "x_On_ComQuestMoney")

--4买道具消耗金钱
function x_On_ItemSpent(MapID, InstanceID, RoleID, ItemID, money)
	UpdateSeverData(4, money)
end
aux.RegisterRoleEvent(75, "x_On_ItemSpent")

--5强化消耗金钱
function x_On_StrengthSpent(MapID, InstanceID, RoleID, EqTypeID, EqGrade, EqBeforLevel, money)
	UpdateSeverData(5, money)
	--玩家强化次数
	UpdateRoleData(RoleID, 3, 1)
	--玩家第一次强化时自身等级
	if aux.GetRoleDataTable(RoleID, 3) == nil or aux.GetRoleDataTable(3) == 0 then
		UpdateRoleData(RoleID, 4, role.GetRoleLevel(MapID, InstanceID, RoleID))
	end
end
aux.RegisterRoleEvent(76, "x_On_StrengthSpent")

--6合成消耗金钱
function x_On_CompositionSpent(MapID, InstanceID, RoleID, ComposedTypeID, money)
	UpdateSeverData(6, money)
	--玩家第一次合成等级
	if aux.GetRoleDataTable(RoleID, 5) == nil or aux.GetRoleDataTable(RoleID, 5) == 0 then
		for k,v in pairs(itemTable[14]) do
			if ComposedTypeID == v then
				UpdateRoleData(RoleID, 6, role.GetRoleLevel(MapID, InstanceID, RoleID))
			end
		end
	end
end
aux.RegisterRoleEvent(77, "x_On_CompositionSpent")

--8-23生成装备
--58-61生成物品
function x_NewItem(MapID, InstanceID, NewTypeID, Grade)
	for k,v in pairs(itemTable) do
		for m,n in pairs(v) do
			if n == NewTypeID then
				if (k >= 15 and k <= 18) and Grade == 4 then
					UpdateSeverData(k + 4, 1)
				else
					UpdateSeverData(k, 1)
				end
				return
			end
		end
	end
end
aux.RegisterWorldEvent(4, "x_NewItem")

--24-37副本统计(总人数,总次数)
function instanceData(fIndex, RoleID, tNumIndex, tTimesIndex)
	local curTime = tonumber(os.date("%j"))
	if f_Roles[fIndex][RoleID] == nil then
		UpdateSeverData(tNumIndex, 1)
		f_Roles[fIndex][RoleID] = curTime
	elseif ftable[fIndex][RoleID] ~= curTime then
		f_Roles[fIndex] = {}
		f_Roles[fIndex][RoleID] = curTime
		UpdateSeverData(tNumIndex, 1)
	end
	UpdateSeverData(tTimesIndex, 1)
end

--39-40物品分解 DisType:1被点化，2被删除，3时间到，4出售
function x_ItemDisappear(DisType, ItemTypeID, Grade)
	if Grade >= 3 then
		UpdateSeverData(39, 1)
		if DisType == 1 then
			UpdateSeverData(40, 1)
		end
	end
end
aux.RegisterWorldEvent(5, "x_ItemDisappear")

--45-46每天参与妖精之泪总人数、次数
function h04_OnPlayerEnter(MapID, InstanceID, RoleID)
	local curTime = tonumber(os.date("%j"))
	if yaoJing_Roles[RoleID] == nil then
		UpdateSeverData(45, 1)
		yaoJing_Roles[RoleID] = curTime
	elseif yaoJing_Roles[RoleID] ~= curTime then
		yaoJing_Roles = {}
		yaoJing_Roles[RoleID] = curTime
		UpdateSeverData(45, 1)
	end
	UpdateSeverData(46, 1)
end
aux.RegisterMapEvent("h04", 2, "h04_OnPlayerEnter")

--[[已迁移到真假魔王脚本中
--50完成真假魔王任务1
function q30501_Complete(MapID, InstanceID, QuestID, RoleID, NPCID)
	UpdateSeverData(50, 1)
	--玩家计数
	UpdateRoleData(RoleID, 11, 1)
end
aux.RegisterQuestEvent(30501, 1, "q30501_Complete")
--51完成真假魔王任务2
function q30502_Complete(MapID, InstanceID, QuestID, RoleID, NPCID)
	UpdateSeverData(51, 1)
	--玩家计数
	UpdateRoleData(RoleID, 11, 1)
end
aux.RegisterQuestEvent(30502, 1, "q30502_Complete")
--52完成真假魔王任务3
function q30503_Complete(MapID, InstanceID, QuestID, RoleID, NPCID)
	UpdateSeverData(52, 1)
	--玩家计数
	UpdateRoleData(RoleID, 11, 1)
end
aux.RegisterQuestEvent(30503, 1, "q30503_Complete")
--]]
--53玩家参与真假魔王活动死亡数
function h03_1_OnRoleDie(MapID, InstanceID, RoleID, KillerID)
	UpdateSeverData(53, 1)
end
aux.RegisterMapEvent("h03_1", 5, "h03_1_OnRoleDie")
aux.RegisterMapEvent("h03_2", 5, "h03_1_OnRoleDie")
aux.RegisterMapEvent("h03_3", 5, "h03_1_OnRoleDie")

--1第几次更新数据
--2完成20级转职任务时的等级	RZY001.lua:r12,RZY002.lua:r12,RZY003.lua:r12,RZY004.lua:r12
--3强化装备次数				x_On_StrengthSpent
--4第一次强化等级			x_On_StrengthSpent
--5生产装备次数	--删除
--6第一次合成生产装等级		x_On_CompositionSpent
--7完成第一个奔雷裂谷主线任务时的等级	q20200_Complete
--8完成北洲天雪第一个任务时的等级		q20300_Complete
--9完成百鬼炼狱的任务的次数		baiguilianyu.lua:r672
--10完成勇闯魔窟的任务的次数		YongChuangMoKu.lua:r386
--11完成真假魔王的任务的次数		q30501_Complete,q30502_Complete,q30503_Complete
--12完成三神任务的次数			MoShenLegend.lua:r238,NvShenLegend.lua:r184,ZhanShenLegend.lua:r207
--13玩家完成竞技场每日奖励次数	Arena_Act.lua:r133
--14玩家击杀魔族入侵怪物次数		MoZuRuQin.lua:r215
--15进入60级以下副本次数			f01.lua:r26,f02.lua:r38,f03.lua:r21,f04.lua:r20
--16进入70级以上副本次数			f05,lua:r33,f06.lua:r46,f07.lua:r20
--17完成风之使者任务次数			fengzhishizhe.lua:r115
--18完成魔界之花任务次数			mojiezhihua.lua:r108
--19完成杀戮密令任务次数			shalumiling.lua:r405
--20领取拳王奖励次数				caiquan.lua:r493

function UpdateRoleData(RoleID, index, var)
--[[
    index = index - 1
	if aux.GetRoleDataTable(RoleID, index) == nil or aux.GetRoleDataTable(RoleID, index) == 0 then
		aux.SetRoleDataTable(RoleID, index, var)
	else
		aux.SetRoleDataTable(RoleID, index, aux.GetRoleDataTable(RoleID, index) + var)
	end
]]
end

--7奔雷主线
function q20200_Complete(MapID, InstanceID, QuestID, RoleID, NPCID)
	UpdateRoleData(RoleID, 7, role.GetRoleLevel(MapID, InstanceID, RoleID))
end
aux.RegisterQuestEvent(20200, 1, "q20200_Complete")

--8北州主线
function q20300_Complete(MapID, InstanceID, QuestID, RoleID, NPCID)
	UpdateRoleData(RoleID, 8, role.GetRoleLevel(MapID, InstanceID, RoleID))
end
aux.RegisterQuestEvent(20300, 1, "q20300_Complete")
